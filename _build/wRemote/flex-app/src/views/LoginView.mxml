<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark"
		skinClass="skins.ViewSkin" actionBarVisible="false" tabBarVisible="false"
		preinitialize="view_preinitializeHandler(event)">
	
	<fx:Script>
		<![CDATA[
			import connections.ServerConnection;
			
			import mx.events.FlexEvent;
			
			
			private var serverConnection:ServerConnection;
			
			protected function view_preinitializeHandler(event:FlexEvent):void
			{
				trace("-loginViewPreinitialize : RETRIEVE SERVER CONNECTION INSTANCE");
				
				serverConnection = ServerConnection.getInstance();
			}
			
			protected function sendInformationButton_clickHandler(event:MouseEvent):void
			{
				trace("-loginViewSendInformation : SENDING SIGNIN REQUEST...");
				
				var login:String = loginInput.text;
				var password:String = passwordInput.text;
				
				navigator.pushView(PlayView);
				
				/*serverConnection.addEventListener(ServerConnection.SIGNIN_SUCCED, serverConnection_signinSuccess);
				serverConnection.addEventListener(ServerConnection.SIGNIN_FAILED, serverConnection_signinFail);
				serverConnection.signinRequest(login, password);
				
				trace("-loginViewSendInformation : WAITING FOR RESPONSE...");
				
				errorLabel_change(false, "");
				sendInformationButton.enabled = false;*/
			}
			
			protected function serverConnection_signinSuccess(event:Event):void
			{
				trace("-loginViewSigninSucced : PUSH PLAY VIEW");
				
				serverConnection.removeEventListener(ServerConnection.SIGNIN_SUCCED, serverConnection_signinSuccess);
				serverConnection.removeEventListener(ServerConnection.SIGNIN_FAILED, serverConnection_signinFail);
				
				sendInformationButton.enabled = true;
				
				navigator.pushView(PlayView);
			}
			
			protected function serverConnection_signinFail(event:Event):void
			{
				trace("-loginViewSigninFailed : DISPLAY ERROR MESSAGE");
				
				serverConnection.removeEventListener(ServerConnection.SIGNIN_SUCCED, serverConnection_signinSuccess);
				serverConnection.removeEventListener(ServerConnection.SIGNIN_FAILED, serverConnection_signinFail);
				
				errorLabel_change(true, "Le serveur ne rÃ©pond pas");
				sendInformationButton.enabled = true;
			}
			
			private function errorLabel_change(displayed:Boolean, text:String):void
			{
				trace("-loginViewErrorLabel : DISPLAYED " + displayed + " TEXT " + text);
				
				errorLabel.visible = displayed;
				errorLabel.includeInLayout = displayed;
				
				errorLabel.text = text;
			}
			
		]]>
	</fx:Script>
	
	<s:VGroup height="70%" width="100%" horizontalAlign="center" gap="0">
		
		<s:Spacer height="6%"/>
		
		<s:Image width="75%" height="40%" smooth="true" smoothingQuality="high"
				 source="assets/background/logo-white.png"/>
		
		<s:Spacer height="10%"/>
		
		<s:Label id="errorLabel" visible="false" includeInLayout="false"
				 fontWeight="bold" color="0xFF1010" fontFamily=""/>
		
		<s:TextInput id="loginInput" prompt="Email ou Identifiant..." width="75%" height="40"
					 skinClass="skins.TextInputTopSkin" color="0x505050"/>
		
		<s:TextInput id="passwordInput" prompt="Mot de passe..." width="75%" height="40"
					 skinClass="skins.TextInputBottomSkin" fontWeight="bold" color="0x505050"
					 displayAsPassword="true"/>
		
		<s:Spacer height="10%"/>
		
		<s:Button id="sendInformationButton" label="GO !" color="0xFCFCFC"
				  skinClass="skins.ButtonSkin" height="20%"
				  click="sendInformationButton_clickHandler(event)"/>
		
	</s:VGroup>
	
	<!--- footer, work fine ! -->
	<s:VGroup width="100%" height="30%" bottom="0" horizontalAlign="right" verticalAlign="bottom">
		
		<s:Image width="50%" height="100%" right="0" horizontalAlign="right" verticalAlign="bottom"
				 smooth="true" smoothingQuality="high" source="assets/background/footer-login-vW.png"/>
		
	</s:VGroup>
	
</s:View>
